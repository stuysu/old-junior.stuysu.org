function init(){setupDraggable(),prepLinks()}function prepLinks(){for(let e of getLinks())e.onclick=()=>setupTable(e.getAttribute("data-link-id"))}function getLinkInputs(e){return{alias:document.getElementById(`link-alias-${e}`),url:document.getElementById(`link-url-${e}`)}}function getLinks(){return document.querySelectorAll(".link")}function getTable(){return document.getElementById("links-table")}function setupTable(e){const t="data-modifying",a=getTable();let n=a.getAttribute(t);const r=document.getElementById(`link-${e}`),{alias:i,url:d}=getLinkInputs("input");if(n!==e){for(let e of getLinks())e.classList.remove("modifying");r.classList.add("modifying"),a.setAttribute(t,e),i.value=r.getAttribute("data-alias"),d.value=r.getAttribute("data-url"),i.disabled=!1,d.disabled=!1}else r.classList.remove("modifying"),a.setAttribute(t,-1),i.value="",d.value="",i.disabled=!0,d.disabled=!0}async function reorder(){const e=getLinks();let t=0;for(let a of e){let e=Number(a.getAttribute("data-link-id"));await sfetch("/api/links/ordering",{method:"PUT",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify({id:e,ordering:t})});t++}alertManager.addAlert("Success","saved the ordering of the links","success")}async function addLink(){const{alias:e,url:t}=getLinkInputs("add");let a=await sfetch("/api/links",{method:"POST",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify({alias:e.value,url:t.value})});a.created?(addLinkToPage(a.id,a.alias,a.url),clearLink(),alertManager.addAlert("Success",`created "${a.alias}" with redirect to "${a.url}`,"success")):alertManager.addAlert("Failure","failed to create link","warning")}async function addLinkToPage(e,t,a){const n=document.getElementById("link-manager");let r=`\n      <div \n        data-link-id="${e}" \n        id="link-${e}" \n        class="link glass"\n\n        data-alias="${t}"\n        data-url="${a}"\n\n        style="margin: 20px;"\n      >\n        ${t} (<span>${a}</span>)\n      </div>\n    `;n.innerHTML=r+n.innerHTML,prepLinks(),reorder()}function clearLink(){const{alias:e,url:t}=getLinkInputs("add");e.value="",t.value=""}async function updateLink(){let e=getTable().getAttribute("data-modifying");-1===e&&void 0===e&&null===e||saveLink(e)}async function removeLink(){let e=getTable().getAttribute("data-modifying");-1===e&&void 0===e&&null===e||deleteLink(e)}async function deleteLink(e){getLinkById(e).remove();const{alias:t,url:a}=getLinkInputs("input");t.value="",a.value="";let n=await sfetch("/api/links/"+e,{method:"DELETE",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer"});n.id?!1===n.deleted?alertManager.addAlert("Failure","did not find a link to delete","secondary"):alertManager.addAlert("Success","deleted link","warning"):alertManager.addAlert("Failure","received an error from the server","danger")}async function saveLink(e){const{alias:t,url:a}=getLinkInputs("input");let n=await sfetch("/api/links",{method:"PUT",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify({id:e,alias:t.value,url:a.value})});if(n.error)alertManager.addAlert("Failure","received an error from the server","danger");else if(n.found&&(n.updatedUrl||n.updatedAlias)){let r="";r+=n.updatedUrl?`"${n.old.url}" to "${n.url}"`:"",r+=n.updatedAlias?`${n.updatedUrl?", ":""}"${n.old.alias}" to "${n.alias}"`:"",alertManager.addAlert("Success",`changed ${r}`,"primary"),updateLinkOnPage(e,t.value,a.value)}else alertManager.addAlert("","Entry not found or no changes were made","secondary")}function getLinkById(e){return document.getElementById(`link-${e}`)}function updateLinkOnPage(e,t,a){const n=getLinkById(e);n.setAttribute("data-alias",t),n.setAttribute("data-url",a),n.innerHTML=`${t} (<span>${a}</span>)`}function getDraggable(){return document.querySelectorAll(".draggable")}init();let dragged=null;function onDragStart(e){this.classList.add("dragging"),getDraggable().forEach((e=>e.classList.remove("dropped"))),dragged=this}function onDragEnd(e){this.classList.remove("dragging"),getDraggable().forEach((e=>{e.classList.remove("over")}))}function onDragOver(e){return e.preventDefault&&e.preventDefault(),this.classList.add("over"),!1}function onDragEnter(e){this.classList.add("over")}function onDragLeave(e){this.classList.remove("over")}function swapElements(e,t){var a=document.createElement("div");e.parentNode.insertBefore(a,e),t.parentNode.insertBefore(e,t),a.parentNode.insertBefore(t,a),a.parentNode.removeChild(a)}async function onDrop(e){return e.stopPropagation(),dragged!==this&&(swapElements(dragged,this),dragged.classList.remove("dropped"),this.classList.remove("dropped"),dragged.classList.add("dropped"),this.classList.add("dropped"),reorder()),!1}function setupDraggable(){getDraggable().forEach((e=>{e.addEventListener("dragstart",onDragStart),e.addEventListener("dragend",onDragEnd),e.addEventListener("dragover",onDragOver),e.addEventListener("dragenter",onDragEnter),e.addEventListener("dragleave",onDragLeave),e.addEventListener("dragend",onDragEnd),e.addEventListener("drop",onDrop)}))}
