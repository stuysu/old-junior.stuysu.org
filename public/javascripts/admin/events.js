function getInputsEvent(e){return{title:document.getElementById(e+"-title-e"),date:document.getElementById(e+"-date-e"),description:document.getElementById(e+"-description-e"),url:document.getElementById(e+"-url-e"),poster:document.getElementById(e+"-poster-e"),thread:document.getElementById(e+"-thread-e"),update:document.getElementById(e+"-update-e"),important:document.getElementById(e+"-important-e"),hidden:document.getElementById(e+"-hidden-e")}}function removeSpaces(e){return e.replace(/\s+/g,"")}function validateLink(e){return""===removeSpaces(e)?void 0:e}function setCalendarTime(e,t){const{date:d}=getInputsEvent(e);let n=new Date(t).toISOString();n=n.substring(0,n.length-1),d.value=n}function getTimestamp(e){return new Date(e.value).getTime()}function getDate(e){return tmp=new Date(e),tmp.setHours(tmp.getHours()-4),tmp=tmp.toISOString(),tmp.substring(0,tmp.length-1)}function getBody(e,t,d,n,a,r,i,o){return JSON.stringify({id:e,title:validateLink(t),date:getTimestamp(d),description:n,url:validateLink(a),poster:validateLink(r),isImportant:i,isHidden:o})}async function removeEvent(e){const{thread:t}=getInputsEvent(e);t.remove();let d=await sfetch("/api/events/"+e,{method:"DELETE",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer"});d.id?!1===d.deleted?alertManager.addAlert("Failure","did not find an event to delete","secondary"):alertManager.addAlert("Success","deleted event","warning"):alertManager.addAlert("Failure","received an error from the server","danger")}async function updateEvent(e){const{title:t,date:d,description:n,url:a,poster:r,important:i,hidden:o}=getInputsEvent(e);let l=await sfetch("/api/events",{method:"PUT",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:getBody(e,t.value,d,n.value,a.value,r.value,i.checked,o.checked)});if(l.error)alertManager.addAlert("Failure","received an error from the server","danger");else if(l.found&&(l.updatedTitle||l.updatedDate||l.updatedDescription||l.updatedUrl||l.updatedPoster||l.updatedIsImportant||l.updatedIsHidden)){let e="",t=!1;e+=l.updatedTitle?`"${l.old.title}" to "${l.title}"`:"",t=!!l.updatedTitle,e+=l.updatedDate?`${t?", ":""}"${l.old.date}" to "${l.date}"`:"",t=!!l.updatedDate,e+=l.updatedDescription?`${t?", ":""}"${l.old.description}" to "${l.description}"`:"",t=!!l.updatedDescription,e+=l.updatedUrl?`${t?", ":""}"${l.old.url}" to "${l.url}"`:"",t=!!l.updatedUrl,e+=l.updatedPoster?`${t?", ":""}"${l.old.poster}" to "${l.poster}"`:"",t=!!l.updatedIsImportant,e+=l.updatedIsImportant?`${t?", ":""}"'is important' ${l.old.isImportant}" to "${l.isImportant}"`:"",t=!!l.updatedIsHidden,e+=l.updatedIsHidden?`${t?", ":""}"'is hidden' ${l.old.isHidden}" to "${l.isHidden}"`:"",alertManager.addAlert("Success",`changed ${e}`,"primary")}else alertManager.addAlert("","Entry not found or no changes were made","secondary")}async function addEvent(){const{title:e,date:t,description:d,url:n,poster:a,important:r,hidden:i}=getInputsEvent("add");let o=await sfetch("/api/events",{method:"POST",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:getBody(void 0,e.value,t,d.value,n.value,a.value,r.checked,i.checked)});o.created?(addEventToPage(o.id,o.title,o.date,o.description,o.url,o.poster,o.isImportant,o.isHidden),e.value="",t.value="",d.value="",n.value="",a.value="",r.checked=!1,alertManager.addAlert("Success",`created event "${o.title}"`,"success")):alertManager.addAlert("Failure","failed to create event","warning")}function addEventToPage(e,t,d,n,a,r,i,o){const l=e=>e||"";d=getDate(d);const s=document.getElementById("main-events");var c={id:e,title:t,date:d,description:n,url:a,poster:r,isImportant:i,isHidden:o};let p=`\n      <div id="${c.id}-thread-e" class="glass event"> \n        <h3 style="margin-top: 10px;">${c.title}</h3>\n        <input type="text" placeholder="Title..." class="form-input glass" id="${c.id}-title-e" value="${c.title}" />\n        <input type="datetime-local" class="form-input glass" id="${c.id}-date-e" value="${c.date}" />\n        <label for="${c.id}-important-e">Important :</label>\n        <input type="checkbox" id="${c.id}-important-e"\n          ${c.isImportant?"checked":""}\n        />\n        <label for="${c.id}-hidden-e">Hidden :</label>\n        <input type="checkbox" id="${c.id}-hidden-e"\n          ${c.isHidden?"checked":""}\n        />\n        <input type="text" class="form-input glass" placeholder="Special redirect..." id="${c.id}-url-e" value="${l(c.url)}" />\n        <input type="text" class="form-input glass" placeholder="Poster image..." id="${c.id}-poster-e" value="${l(c.poster)}" />\n        <textarea style="height: 150px;" type="text" class="form-input glass" id="${c.id}-description-e"">${l(c.description)}</textarea>\n        <button class="glass button" onclick="updateEvent('${c.id}')">Update</button>\n        <button class="glass button" onclick="removeEvent('${c.id}')">Delete</button>\n      </div>\n    `;s.innerHTML+=p}
