const express=require("express"),route=express.Router(),{verifySignInToken:verifySignInToken,isDoubleCookieValid:isDoubleCookieValid,getAccessToken:getAccessToken,TokenCookie:TokenCookie,requireAuthAdmin:requireAuthAdmin,requireUnauthAdmin:requireUnauthAdmin,toSignIn:toSignIn,SignInCookie:SignInCookie}=require("../auth.js");route.get("/signin",requireUnauthAdmin(),((e,i,n)=>{const o=SignInCookie.getAndClear(e,i);i.render("admin/signin",{client_id:process.env.CLIENT_ID,message:o})})),route.get("/signout",requireAuthAdmin(),((e,i,n)=>{TokenCookie.clear(i),toSignIn(i)})),route.post("/login",requireUnauthAdmin(),(async(e,i,n)=>{try{await isDoubleCookieValid(e);let n=await verifySignInToken(e.body.credential);n.ok&&(TokenCookie.set(i,getAccessToken(n.payload)),i.redirect("/admin"))}catch(e){console.error(e),toSignIn(i,e.message)}})),module.exports=route;
