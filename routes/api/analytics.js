const express=require("express"),router=express.Router(),{sequelize:sequelize,Analytics:Analytics}=require("./../../models"),{CreateError:CreateError}=require("../utils"),{requireAuthApi:requireAuthApi}=require("../auth");router.get("/analytics",(async(r,e,t)=>{try{e.status(200).json(await Analytics.findAll())}catch(r){t(CreateError(400,r))}})),router.put("/analytics/reset",requireAuthApi(),(async(r,e,t)=>{try{let t=await Analytics.update({views:0},{where:{url:r.body.url}});e.status(200).json({reset:t[0]>0,url:r.body.url})}catch(r){t(CreateError(400,r))}})),router.put("/analytics/toggle",requireAuthApi(),(async(r,e,t)=>{try{let u=await Analytics.findByPk(r.body.url);null===u&&t(CreateError(400,"Could not find entry by url "+r.body.url));let a=!u.tracking,s=await Analytics.update({tracking:a},{where:{url:r.body.url}});e.status(200).json({worked:s[0]>0,url:r.body.url,tracking:a})}catch(r){t(CreateError(400,r))}})),module.exports=router;
