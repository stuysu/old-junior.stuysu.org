"use strict";const fs=require("fs"),path=require("path"),Sequelize=require("sequelize"),basename=path.basename(__filename),env=process.env.NODE_ENV||"development",config=require(__dirname+"../../config/config.js")[env],db={};let sequelize;if(sequelize=config.use_env_variable?new Sequelize(process.env[config.use_env_variable],config):new Sequelize(config.url,config),"win32"===process.platform){var split=sequelize.options.storage.match(/(?<driveprefix>[A-Z]:\\):[A-Z]\\(?<filepath>.+)/);sequelize.options.storage=split[1]+split[2],sequelize.connectionManager.config.database=split[1]+split[2]}function isModel(e){return 0!==e.indexOf(".")&&e!==basename&&".model.js"===e.slice(-9)}fs.readdirSync(__dirname).filter(isModel).forEach((e=>{const i=require(path.join(__dirname,e))(sequelize,Sequelize.DataTypes);db[i.name]=i})),Object.keys(db).forEach((e=>{db[e].associate&&db[e].associate(db)})),db.sequelize=sequelize,db.Sequelize=Sequelize,module.exports=db;
